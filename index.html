<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Sauerbraten95">
    <title>Anno 1800 Calculator</title>


    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="bootstrap-notify.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>

    <script type="text/javascript" src="i18n.js"></script>
    <script type="text/javascript" src="AnnoCalculator.js"></script>
    <script type="text/javascript" src="params_2020-10-22_full.js"></script>
</head>
<body>
    <!-- #params-dialog -->
    <div id="params-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Enter parameters</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <textarea class="form-control" rows="5" id="input-params"></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /#params-dialog -->
    <!-- #settings-dialog -->
    <div id="settings-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.settings.name">Settings</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <form>
                        <table class="table table-striped">
                            <tbody data-bind="foreach: settings.options">
                                <tr>
                                    <td>
                            <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                            <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <span data-bind="if: $data.id == 'additionalProduction'">
                                                <button data-dismiss="modal" data-bind="click: () => setTimeout(() => $('#item-equipment-dialog').modal(),500)" class="btn btn-light btn-sm">
                                        <span class="fa fa-cog"> </span>
                                    </button>
                                </span>
                                            <span data-bind="if: $data.id == 'consumptionModifier'">
                                                <button data-dismiss="modal" data-bind="click: () => setTimeout(() => $('#good-consumption-island-upgrade-dialog').modal(),500)" class="btn btn-light btn-sm">
                                        <span class="fa fa-cog"> </span>
                                    </button>
                                </span>
                            </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr />
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" data-bind="text: texts.language.name">Language</span>
                            </div>

                            <select name="language" class="custom-select" id="language" data-bind="value: settings.language, options:settings.languages"></select>
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" data-bind="text: texts.selectedIsland.name">Select Island</span>
                            </div>

                            <select name="islands" class="custom-select" id="islands" data-bind="value: view.island, options: view.islands, optionsText: i => i.name()"></select>
                            <div class="input-group-append">
                                <button class="btn btn-secondary" data-dismiss="modal" data-bind="click: () => setTimeout(() => $('#island-management-dialog').modal(),500)" class="btn btn-light">
                                    <span class="fa fa-cog"> </span>
                                </button>

                            </div>
                        </div>
                        <hr />
                        <h6>Server<button type="button" class="help" data-toggle="modal" data-target="#download-dialog">?</button></h6>
                        <div data-bind="foreach: settings.serverOptions">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- #/settings-dialog -->
    <!-- #help-dialog -->
    <div id="help-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.help.name">Settings</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <a  href="https://www.youtube.com/watch?v=fxzYSh-92Ng" target="_blank">
                        <img class="img-thumbnail img-responsive" src="CalculatorScreenshot.jpg" />
                    </a>
                    <br />
                    <span data-bind="text: texts.helpContent.name" style="white-space:pre-wrap"></span>

                </div>
            </div>
        </div>
    </div>
    <!-- /#help-dialog -->
    <!-- #factory-choose-dialog -->
    <div id="factory-choose-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.chooseFactories.name">Choose Factory for each Product</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <form>
                        <div data-bind="foreach: $root.island().multiFactoryProducts">


                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                        <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                    </span>
                                    <span class="input-group-text" data-bind="text: name"></span>
                                </div>

                                <select class="custom-select" data-bind="value: $data.fixedFactory, options: $data.factories, optionsText: f => f.getRegionExtendedName(), optionsCaption: $root.texts.noFixedFactory.name()"></select>
                            </div>
                        </div>
                        <hr />

                        <div data-bind="foreach: $root.island().replaceInputItems">
                            <div class="ui-fchain-item" style="display: flex; flex-direction: column; justify-content:space-between; height: 12rem">

                                <div class="ui-fchain-item-tr-checkbox">
                                    <div data-bind="foreach: $data.equipments" style="display:flex">
                                        <span class="custom-control custom-checkbox ml-1">
                                            <input class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $parent.guid + '-' + $data.factory.guid + '-checked' }" type="checkbox">
                                            <label class="custom-control-label" src-only="" data-bind="attr: { for: $parent.guid + '-' + $data.factory.guid + '-checked' }">&#8203;</label>
                                        </span>
                                    </div>
                                </div>

                                <div class="ui-fchain-item-name" style="height: unset">

                                    <span data-bind="text: name"></span>
                                </div>

                                <div class="ui-fchain-item-icon" data-bind="foreach: $data.factories"><img src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }"></div>


                                <div data-bind="foreach: $data.replacementArray">
                                    <div class="ui-fchain-item-icon-replacement">
                                        <span class="strike-through">
                                            <img src="" data-bind="attr: { src: $data.old.icon ? $data.old.icon : null, alt: $data.old.name }" width="30" height="30">
                                        </span>
                                        <div class="ui-replacement-spacer">
                                            →
                                        </div>
                                        <img src="" data-bind="attr: { src: $data.new.icon ? $data.new.icon : null, alt: $data.new.name }" width="30" height="30">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- #/factory-choose-dialog -->
    <!-- #download-dialog -->
    <div id="download-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.download.name">Downloads</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <table class="table">
                        <tr>
                            <td data-bind="text: texts.downloadConfig.name"></td>
                            <td>
                                <div class="btn-group float-right">
                                    <label class="btn btn-secondary" id="import-config-button" role="button" href="#" for="config-selector">
                                        <input id="config-selector" type="file" style="display: none;">
                                        <span class="fa fa-upload"> </span>
                                    </label>
                                    <label data-bind="click: () => exportConfig()" id="export-config-button" role="button" href="#" class="btn btn-secondary">
                                        <span class="fa fa-download"> </span>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td data-bind="text: texts.downloadCalculator.name" style="white-space:pre-wrap"></td>
                            <td>
                                <a id="download-calculator-button" role="button" href="https://github.com/NiHoel/Anno1800Calculator/releases/latest" class="btn btn-secondary float-right">
                                    <span class="fa fa-download"> </span>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span data-bind="text: texts.downloadCalculatorServer.name" style="white-space:pre-wrap"></span>
                                <a href="https://github.com/NiHoel/Anno1800UXEnhancer">https://github.com/NiHoel/Anno1800UXEnhancer</a>
                            </td>
                            <td>
                                <a id="download-calculator-server-button" role="button" href="https://github.com/NiHoel/Anno1800UXEnhancer/releases/latest" class="btn btn-secondary float-right">
                                    <span class="fa fa-download"> </span>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- /#download-dialog -->
    <!-- #item-equipment-dialog -->
    <div id="item-equipment-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.itemsEquipped.name">Items equipped</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead style="text-align: center">
                        <th></th>
                        <th></th>
                        <th data-bind="text: $root.texts.extraGoods.name">Extra Goods</th>
                        <th data-bind="text: $root.texts.productionBuildings.name">Production Buildings</th>
                        <th data-bind="text: $root.texts.all.name">All</th>
                        </thead>
                        <tbody data-bind="foreach: $root.island().extraGoodItems">
                            <tr>
                                <td><img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null}"></td> <!-- item icon -->
                                <td data-bind="text: $data.name"></td> <!-- item name -->
                                <td>
                                    <span data-bind="foreach: $data.extraGoods" style="display: flex;">
                                        <!-- icon extra goods -->
                                        <span style="flex: 100 1 auto;"></span>

                                        <span style="flex: auto;">
                                            <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon  : null, alt: $data.name}" />
                                        </span>

                                        <span style="flex: 100 1 auto;"></span>
                                    </span>
                                </td>
                                <td>
                                    <span data-bind="foreach: $data.equipments" style="display: flex; flex-flow: wrap; justify-content: center">

                                        <span style="flex-basis: fit-content;">
                                            <span class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.factory.guid + '-' + $data.item.guid + '-equipped' }">
                                                <label class="custom-control-label" data-bind="attr: { for: $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" src-only style="vertical-align: top;">

                                                </label>
                                            </span>
                                        </span>

                                        <span class="mr-2" style="flex-basis: fit-content;">
                                            <img src="" width="25" height="25" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon  : null, alt: $data.factory.name, for: $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                        </span>
                                    </span>
                                </td>

                                <td>
                                    <span>
                                        <span class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-check-all' }">
                                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-check-all' }" src-only style="vertical-align: top;"> </label>
                                        </span>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <!-- #/item-equipment-dialog -->
    <!-- #good-consumption-upgrade-island-dialog -->
    <div id="good-consumption-island-upgrade-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" data-bind="with: $root.island().allGoodConsumptionUpgrades">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.needConsumption.name">Need Consumption</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <h6 data-bind="text: $root.texts.newspaper.name">Newspaper</h6>
                    <form>
                        <div class="form mb-3" data-bind="foreach: $root.newspaperConsumption.allEffects">
                            <span class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                <label class="custom-control-label" data-bind="text: $data.name() + ' ' + formatPercentage($data.amount), attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                            </span>
                        </div>

                        <div class="form-inline">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" data-bind="text: $root.texts.newspaperEffectiveness.name">Newspaper Effectiveness</span>
                                </div>

                                <select class="custom-select" data-bind="value: $root.newspaperConsumption.selectedBuff, options: $root.newspaperConsumption.selectableBuffs, optionsText: p => formatPercentage(p)"></select>
                            </div>

                            <div class="custom-control">
                                <span data-bind="text: $root.texts.reducedNeeds.name">Reduced Needs</span>
                                <span>: </span>
                                <span data-bind="text: formatPercentage($root.newspaperConsumption.amount())"></span>
                            </div>
                        </div>
                    </form>
                    <table class="table table-striped">
                        <tbody data-bind="foreach: $data.upgrades">
                            <tr>
                                <td>

                                    <span class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                        <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                    </span>
                                </td>
                                <td><img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null}"></td> <!-- upgrade icon -->
                                <td data-bind="text: $data.name"></td> <!-- upgrade name -->
                                <td>
                                    <span data-bind="foreach: $data.entries" style="display: flex; flex-flow: wrap; justify-content: center">
                                        <div>
                                            <span data-bind="text: formatPercentage($data.amount)"></span>
                                            <span class="ml-1 mr-2" style="flex-basis: fit-content;" data-bind="if: $data.product">
                                                <img src="" width="25" height="25" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name, title: $data.product.name}" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                            </span>
                                        </div>

                                    </span>
                                </td>

                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="click: () => $data.apply()">
                        <span class="fa fa-sign-in"> </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- #/good-consumption-island-upgrade-dialog -->
    <!-- #island-management-dialog -->
    <div id="island-management-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.islands.name">Islands</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" data-bind="text: texts.selectedIsland.name">Select Island</span>
                        </div>

                        <select name="islands" class="custom-select" id="islands" data-bind="value: view.island, options: view.islands, optionsText: i => i.name()"></select>

                    </div>

                    <hr />

                    <form data-bind="submit: () => $root.islandManager.create()">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" data-bind="text: texts.islandName.name">New Island</span>
                            </div>

                            <input name="island" class="form-control" id="island" type="text" data-bind="value: $root.islandManager.islandNameInput" />
                            <div class="input-group-append">
                                <button class="btn btn-secondary" data-bind="disable: $root.islandManager.islandExists">
                                    <span class="fa fa-plus"> </span>
                                </button>

                            </div>
                        </div>
                    </form>
                    <div class="custom-control custom-checkbox mb-3">
                        <input id="checkbox-show-island-on-creation" type="checkbox" class="custom-control-input" data-bind="checked: $root.islandManager.showIslandOnCreation.checked">
                        <label class="custom-control-label" for="checkbox-show-island-on-creation" data-bind="text: $root.islandManager.showIslandOnCreation.name"></label>
                    </div>

                    <table class="table table-striped">

                        <tbody data-bind="foreach: $root.islandManager.unusedNames">
                            <tr>
                                <td data-bind="text: $data"></td>
                                <td>
                                    <span class="float-right">
                                    <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.islandNameInput($data)">
                                        <span class="fa fa-pencil"> </span>
                                    </button>
                                    <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.create($data)">
                                        <span class="fa fa-plus"> </span>
                                    </button>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <hr />
                    <h6 data-bind="text: $root.texts.world.name">The World</h6>
                    <table class="table table-striped">

                        <tbody data-bind="foreach: $root.islands">
                            <tr>
                                <td data-bind="text: $data.name"></td> <!-- item name -->
                                <td>
                                    <div style="display: flex; flex-flow: wrap; justify-content: center">
                                        <span class="mr-3">
                                            <img src="icon_residence.png" width="25" height="25" data-bind="visible: !$root.settings.existingBuildingsInput.checked()">
                                            <img src="icon_house.png" width="25" height="25" data-bind="visible: $root.settings.existingBuildingsInput.checked()">
                                        </span>
                                        <span data-bind="if: !$data.top2Population().length">0</span>
                                        <span data-bind="foreach: $data.top2Population" style="display: flex; flex-flow: wrap; justify-content: center">
                                            <span class="ui-tier-unit-icon" class="mr-1">
                                                <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                            </span>
                                            <span class="mr-3" data-bind="text: $root.settings.existingBuildingsInput.checked() ? $data.existingBuildings() : $data.amount()"></span>
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; flex-flow: wrap; justify-content: center">
                                        <span class="mr-3">
                                            <img src="icon_resource_storage_amount.png" width="25" height="25">
                                        </span>
                                        <span data-bind="if: !$data.top5Factories().length">0</span>
                                        <span data-bind="foreach: $data.top5Factories" style="display: flex; flex-flow: wrap; justify-content: center">
                                            <span class="mr-1">
                                                <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                            </span>
                                            <span class="mr-3" data-bind="text: $root.settings.missingBuildingsHighlight.checked() ? $data.existingBuildings() : Math.ceil($data.buildings())"></span>
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="float-right" data-bind="if: !$data.isAllIslands()">
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.delete($data)">
                                            <span class="fa fa-trash"> </span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-bind="text: $root.texts.deleteAll.name, click: factoryReset">Delete All</button>
            </div>
        </div>
    </div>
    </div>
    <!-- #/island-management-dialog -->
    <!-- top right buttons -->
    <div id="content" data-bind="visible: true" style="display:none">

        <div class="fixed-top" style="padding-right: 17px;">
            <div class="btn-group float-right">
                <button data-bind="click: () => $root.darkMode.toggle()" class="btn btn-secondary">
                    <span class="fa fa-adjust"> </span>
                </button>
                <button data-toggle="modal" data-target="#settings-dialog" class="btn btn-secondary">
                    <span class="fa fa-cog"> </span>
                </button>
                <button data-toggle="modal" data-target="#factory-choose-dialog" class="btn btn-secondary">
                    <span class="fa fa-cogs"> </span>
                </button>
                <button data-toggle="modal" data-target="#help-dialog" class="btn btn-secondary">
                    <span class="fa fa-question-circle-o"> </span>
                </button>
                <button id="download-selection-button" data-toggle="modal" data-target="#download-dialog" class="btn btn-secondary">
                    <span class="fa fa-download"> </span>
                </button>
            </div>
        </div>
        <!-- /top right buttons-->

        <div data-bind="with: $root.island()">
            <!-- population input field -->
            <fieldset class="ui-fieldset" id="residents-view">
                <legend data-bind="text:$root.texts.residents.name">Residents</legend>

                <div style="display:flex;align-items:center;justify-content:space-between;">

                    <div class="ui-tier-input fleft">
                        <!-- <div class="ui-tier-icon">
                            <img src="/img/icons/gui_icon_map_0-17-10.png" alt="Old World" width="46" height="46">
                        </div> -->
                        <div data-bind="foreach: $data.populationLevels">
                            <div class="ui-tier-unit">
                                <div class="ui-tier-unit-icon">
                                    <img src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                    <img src="icon_residence.png" class="subscript-icon" data-bind="visible: !$root.settings.existingBuildingsInput.checked()">
                                    <img src="icon_house.png" class="subscript-icon" data-bind="visible: $root.settings.existingBuildingsInput.checked()" style="margin-bottom: -5px;">
                                </div>
                                <div class="ui-tier-unit-name" data-bind="visible: !$root.settings.hideNames.checked(), attr: {'tier-unit-guid' : guid}">
                                    <span data-bind="visible: hotkey, text: hotkey() ? '[' + hotkey().toUpperCase() + '] ' : ''"></span>
                                    <span data-bind="text: name"></span>
                                </div>

                                <div class="input text">
                                    <div class="input-group spinner mb-3">
                                        <div data-bind="if: !$root.settings.existingBuildingsInput.checked()">
                                            <input step="100" class="form-control input-lg" type="number" value="0" data-bind="value: amount, attr: {title: 'Press '+name()[0]+' to focus' };" />
                                        </div>
                                        <div data-bind="if: $root.settings.existingBuildingsInput.checked()">
                                            <input step="10" class="form-control input-lg" type="number" value="0" data-bind="value: existingBuildings, attr: {title: 'Press '+name()[0]+' to focus' };" />
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <btn class="btn btn-light float-right align-middle" data-bind="click: () => $root.island().reset(), text: $root.texts.reset.name()">Reset</btn>
                </div>
            </fieldset>
            <!-- /population input field -->
            <!-- required workforce field -->
            <fieldset class="ui-fieldset" id="workforce-view">
                <legend class="collapser" data-toggle="collapse" data-target="#workforce">
                    <span class="fa fa-chevron-right"></span>
                    <span class="fa fa-chevron-down"></span>
                    <span data-bind="text:$root.texts.workforce.name"></span>
                </legend>

                <div id="workforce" class="collapse show">

                    <div class="ui-tier-input fleft">
                        <!-- <div class="ui-tier-icon">
                            <img src="/img/icons/gui_icon_map_0-17-10.png" alt="Old World" width="46" height="46">
                        </div> -->
                        <div data-bind="foreach: $data.workforce">
                            <div class="ui-tier-unit">
                                <div class="ui-tier-unit-icon"><img data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }"></div>
                                <!--<div class="ui-tier-unit-name" data-bind="text: name"></div>-->
                                <div class="ui-fchain-item-count">
                                    <span data-bind="text: amount"></span>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="clear"></div>
                </div>
            </fieldset>
            <!-- /required workforce field -->
            <!-- #factory-config-dialog -->
            <div id="factory-config-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" data-bind="with: $root.selectedFactory()">
                        <div class="modal-header">
                            <h4 data-bind="text: $data.name">Factory Name</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                        </div>
                        <div class="modal-body">
                            <div data-bind="visible: $data.items.length && $root.settings.additionalProduction.checked()">
                            <h6 data-bind="text: $root.texts.itemsEquipped.name">Equipped Items</h6>
                            <table class="table table-striped">
                                <tbody data-bind="foreach: $data.items">
                                    <tr>
                                        <td>
                                                <div style="display: flex">
                                            <span class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.factory.guid + '-' + $data.item.guid + '-equipped' }">
                                                <label class="custom-control-label" data-bind="attr: { for: $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" src-only style="vertical-align: top;">

                                                </label>
                                            </span>
                                                    <img class="mr-2" src="" width="25" height="25" data-bind="attr: { src: $data.item.icon ? $data.item.icon : null}"><!-- item icon -->
                                                    <span data-bind="text: $data.name"></span> <!-- item name -->
                                                </div>
                                        </td>
                                        <td>
                                            <span data-bind="if: $data.item.extraGoods">
                                                <span data-bind="foreach: $data.item.extraGoods" style="display: flex; flex-flow: wrap;">
                                                    <!-- icon extra goods -->
                                                    <span style="flex: 100 1 auto;"></span>

                                                    <span style="flex: auto;">
                                                        <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon  : null, alt: $data.name}" />
                                                    </span>

                                                    <span style="flex: 100 1 auto;"></span>
                                                </span>
                                            </span>
                                            <div dat-bind="if: $data.replacementArray">
                                                <div data-bind="foreach: $data.replacementArray">
                                                    <div class="ui-fchain-item-icon-replacement">
                                                        <span class="strike-through">
                                                            <img src="" data-bind="attr: { src: $data.old.icon ? $data.old.icon : null, alt: $data.old.name }" width="30" height="30">
                                                        </span>
                                                        <div class="ui-replacement-spacer">
                                                            →
                                                        </div>
                                                        <img src="" data-bind="attr: { src: $data.new.icon ? $data.new.icon : null, alt: $data.new.name }" width="30" height="30">
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                                <hr />
                            </div>

                            <div data-bind="visible: $data.extraGoodsNonZero().length && $root.settings.additionalProduction.checked()">


                                <h6><span data-bind="text: $root.texts.extraGoods.name">Extra Goods</span><span> </span><img src="" width="35" height="35" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}" /></h6>
                                <table class="table table-striped">
                                    <tbody data-bind="foreach: $data.extraGoodsNonZero">
                                        <tr>

                                            <td>
                                                <div data-bind="if: $data.item">
                                                    <img src="" width="25" height="25" data-bind="attr: { src: $data.item.item.icon ? $data.item.item.icon : null, alt: $data.item.name}"> <!-- item icon -->
                                                    <img src="" width="25" height="25" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon : null, alt: $data.factory.name}">
                                                </div>
                                                <div data-bind="if: !$data.item">
                                                    <span data-bind="$root.texts.total.name" style="font-weight: bold">Total</span>
                                                </div>
                                            </td> <!-- factory icon -->
                                            <td>
                                                <span data-bind="text: Math.ceil(100*parseFloat($data.amount()))/100"></span>
                                                <span> t/min</span>

                                                    <span data-bind="if: !$data.item" style="float: right;">
                                                        <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="click: () => $parent.updateExtraGoods()">
                                                            <span class="fa fa-sign-in"> </span>
                                                        </button>
                                                    </span>

                                            </td>

                                        </tr>
                                    </tbody>
                                </table>

                                <hr />
                            </div>


                            <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <!-- boost -->
                                        <td>
                                            <span data-bind="text: $root.texts.productionBoost.name"></span>
                                        </td>
                                        <td>
                                            <div href="#" data-toggle="tooltip">
                                                <div class="input-group mb-3 spinner">
                                                    <input class="form-control" type="text" value="100" data-bind="value: percentBoost" />
                                                    <div class="input-group-append">
                                                        <div class="input-group-btn-vertical">
                                                            <button class="btn btn-default" type="button" data-bind="click: incrementPercentBoost"><i class="fa fa-caret-up"></i></button>
                                                            <button class="btn btn-default" type="button" data-bind="click: decrementPercentBoost, enable: parseInt(percentBoost()) > 1"><i class="fa fa-caret-down"></i></button>
                        </div>
                                                        <span class="input-group-text">%</span>
                    </div>
                </div>
            </div>
                                        </td>
                                    </tr>
                                    <tr data-bind="visible: $root.settings.missingBuildingsHighlight.checked()">
                                        <!-- existing buildings -->
                                        <td>
                                            <span data-bind="text: $root.texts.existingNumberOfBuildings.name"></span>
                                        </td>
                                        <td>
                                            <div href="#" data-toggle="tooltip">
                                                <div class="input-group mb-3 spinner">
                                                    <input class="form-control" type="text" value="100" data-bind="value: existingBuildings" />
                                                    <div class="input-group-append">
                                                        <div class="input-group-btn-vertical">
                                                            <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings() + 1))"><i class="fa fa-caret-up"></i></button>
                                                            <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings() - 1)), enable: parseInt(existingBuildings()) > 1"><i class="fa fa-caret-down"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                    <tr data-bind="visible: $root.settings.additionalProduction.checked()">
                                        <!-- extra goods -->
                                        <td>
                                            <span data-bind="text: $root.texts.extraNeed.name"></span>
                                        </td>
                                        <td>
                                            <div class="input-group spinner mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">+ </span>
                                                    <span data-bind="visible: $data.extraAmount() < -EPSILON - $data.extraGoodsTotal()">
                                                        <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                    </span>
                                                </div>
                                                <input step="0.1" class="form-control" type="number" value="0" data-bind="value: extraAmount" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-bind="if: $data.module && $data.moduleChecked()">
                                        <!-- extra goods module -->
                                        <td>
                                            <span data-bind="text: $root.texts.extraGoods.name"></span>
                                            <span>: </span>
                                            <span data-bind="text: $data.module.name"></span>
                                        </td>
                                        <td>
                                            <div class="float-right">
                                                <img class="mr-2" src="" width="25" height="25" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                                <span data-bind="text: Math.ceil(100*parseFloat($data.producedAmount() / $data.module.additionalOutputCycle))/100"></span><span> t/min</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-bind="if: $data.palaceBuff && $data.palaceBuffChecked()">
                                        <!-- extra goods palace -->
                                        <td>
                                            <span data-bind="text: $root.texts.extraGoods.name"></span>
                                            <span>: </span>
                                            <span data-bind="text: $data.palaceBuff.name"></span>
                                        </td>
                                        <td>
                                            <div class="float-right">
                                                <img class="mr-2" src="" width="25" height="25" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                                <span data-bind="text: Math.ceil(100*parseFloat($data.producedAmount() / $data.palaceBuff.additionalOutputCycle))/100"></span><span> t/min</span>
                                                <div class="float-right">
                                        </td>
                                    </tr>
                                    <tr data-bind="if: $data.module && $data.moduleChecked()">
                                        <!-- consumption module -->
                                        <td>
                                            <span data-bind="text: $root.texts.consumption.name"></span>
                                            <span>: </span>
                                            <span data-bind="text: $data.module.name"></span>
                                        </td>
                                        <td>
                                            <div class="float-right">
                                                <img class="mr-2" src="" width="25" height="25" data-bind="attr: { src: $data.moduleDemand.product.icon ? $data.moduleDemand.product.icon : null, alt: $data.moduleDemand.product.name}">
                                                <span data-bind="text: Math.ceil(100*$data.moduleDemand.amount())/100"></span><span> t/min</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
            <!-- #/factory-config-dialog -->
            <!-- required factories by category -->
            <div data-bind="foreach: { data: $data.categories, as: 'category'}">
                <fieldset class="ui-fieldset" id="categories-view">
                    <legend class="collapser" data-toggle="collapse" data-bind="attr: {'data-target' : '#category-' + guid}">
                        <span class="fa fa-chevron-right"></span>
                        <span class="fa fa-chevron-down"></span>
                        <span data-bind="text:name"></span>
                    </legend>

                    <div class="ui-fchain collapse show" data-bind="attr: {id:  'category-' + guid}">
                        <div data-bind="foreach: $data.products">
                            <div data-bind="foreach: $data.factories">
                                <div>

                                    <div class="ui-fchain-item" data-bind="visible: amount() > 0 || existingBuildings() > 0 || $data.editable && (!$root.settings.hideNewWorldConstructionMaterial.checked() || $data.region.guid === 5000000), css: $root.settings.missingBuildingsHighlight.checked() && buildings() > existingBuildings() ? 'danger' : ''">
                                        <div class="ui-fchain-item-tr-button" data-bind="if: $root.settings.additionalProduction.checked() || $root.settings.missingBuildingsHighlight.checked()">
                                            <div>
                                            <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedFactory($data)}" data-toggle="modal" data-target="#factory-config-dialog">
                                                <span class="fa fa-sliders"></span>
                                            </button>
                                            </div>
                                        </div>

                                        <div class="ui-fchain-item-name" data-bind="text: $data.getRegionExtendedName(), visible: !$root.settings.hideNames.checked()"></div>

                                        <div class="ui-fchain-item-icon">
                                            <img src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                    </div>
                                    <div class="ui-fchain-item-boost">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.productionBoost.name}, visible: !$root.settings.hideProductionBoost.checked()">
                                                <div class="input-group mb-3 spinner">
                                                    <input class="form-control" type="text" value="100" data-bind="value: percentBoost" />
                                                    <div class="input-group-append">
                                                        <div class="input-group-btn-vertical">
                                                            <button class="btn btn-default" type="button" data-bind="click: incrementPercentBoost"><i class="fa fa-caret-up"></i></button>
                                                            <button class="btn btn-default" type="button" data-bind="click: decrementPercentBoost, enable: parseInt(percentBoost()) > 1"><i class="fa fa-caret-down"></i></button>
                                                        </div>
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    <div class="ui-fchain-item-attribute-group">
                                        <div>
                                        <!-- buildings display for non-construction products -->
                                        <div class="ui-fchain-item-count" data-bind="if: !$data.editable">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                                <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? Math.ceil(100*parseFloat(buildings()))/100 : Math.ceil(buildings())"></span>
                                                <span>x</span>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-secondary" data-bind="click: () => incrementBuildings(), enable: buildings() > 0" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                                    <button type="button" class="btn btn-secondary" data-bind="click: () => decrementBuildings(), enable: buildings() >= 1.01" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- existing buildings input for non-construction products -->
                                        <div class="ui-fchain-item-count" data-bind="if: !$data.editable && $root.settings.missingBuildingsHighlight.checked()">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.existingNumberOfBuildings.name}">
                                                <span data-bind="text: $root.texts.existingNumberOfBuildingsIs.name"></span>
                                                <span data-bind="text: existingBuildings()"></span>
                                                <span>x</span>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-secondary" data-bind="click: () => existingBuildings(parseInt(existingBuildings() + 1))" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                                    <button type="button" class="btn btn-secondary" data-bind="click: () => existingBuildings(parseInt(existingBuildings() - 1)), enable: existingBuildings() >= 1" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- buildings input for construction material -->
                                        <div class="ui-fchain-item-count" data-bind="if: $data.editable">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                                <div class="input-group mb-3 spinner">
                                                    <input class="form-control" type="text" value="0" step="1" data-bind="value: existingBuildings" />
                                                    <div class="input-group-append">
                                                        <div class="input-group-btn-vertical">
                                                            <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings()) + 1)"><i class="fa fa-caret-up"></i></button>
                                                            <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings()) - 1), enable: existingBuildings() > 0"><i class="fa fa-caret-down"></i></button>
                                                        </div>
                                                        <span class="input-group-text">x</span>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <!-- required buildings display for construction materials -->
                                        <div class="ui-fchain-item-count" data-bind="if: $data.editable &&  buildings() > existingBuildings()">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildingsDescription.name}" style="display: flex">
                                                <span data-bind="text: $root.texts.requiredNumberOfBuildings.name"></span>
                                                <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? Math.ceil(100*parseFloat(buildings()))/100 : Math.ceil(buildings())"></span>
                                                <span>x</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ui-fchain-item-amount" href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                            <div class="ui-fchain-item-load"><span data-bind="text: Math.ceil(100*parseFloat(amount()))/100"></span><span> t/min</span></div>

                                        </div>

                                        <div class="ui-fchain-item-module" data-bind="if: !!$data.module || !!$data.palaceBuff">
                                            <div style="flex: 100 1 auto;"></div>

                                            <!-- module -->
                                            <div data-bind="if: !!$data.module" style="flex: auto;">
                                                <div class="custom-control custom-checkbox" data-bind="if: !!$data.module">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.moduleChecked, attr: { id: category.guid + '-' + $data.guid + '-module' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: category.guid + '-' + $data.guid + '-module', title: $data.module.name }" src-only style="vertical-align: top;">

                                                    </label>
                                                </div>
                                            </div>
                                            <div data-bind="if: !!$data.module" style="flex: auto;">
                                                <img src="" width="25" height="25" data-bind="attr: { src: $data.module.icon ? $data.module.icon  : null, alt: $data.module.name, for: $data.guid + '-module' }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                                            </div>

                                            <!-- palace buff -->
                                            <div data-bind="if: !!$data.palaceBuff" style="flex: auto;">
                                                <div class="custom-control custom-checkbox" data-bind="if: !!$data.palaceBuff">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.palaceBuffChecked, attr: { id: category.guid + '-' + $data.guid + '-palaceBuff' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: category.guid + '-' + $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" src-only style="vertical-align: top;">

                                                    </label>
                                                </div>
                                            </div>
                                            <div data-bind="if: !!$data.palaceBuff" style="flex: auto;">
                                                <img src="" width="25" height="25" data-bind="attr: { src: $data.palaceBuff.icon ? $data.palaceBuff.icon  : null, alt: $data.palaceBuff.name, for: $data.guid + '-palaceBuff' }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                                            </div>
                                            <div style="flex: 100 1 auto;"></div>
                                        </div>
                                    </div>
                                    <div class="ui-fchain-item-load" data-bind="visible: $root.settings.additionalProduction.checked()">
                                        <div class="ui-fchain-item-extra-input">
                                            <div class="input-group spinner mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">+ </span>
                                                        <span data-bind="visible: $data.extraAmount() < -EPSILON - $data.extraGoodsTotal()">
                                                            <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                        </span>
                                                    </div>
                                                <input step="0.1" class="form-control" type="number" value="0" data-bind="value: extraAmount" />
                                            </div>
                                        </div>
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.producedAmount.name}" style="border-top-color: inherit; border-top-style: solid; border-top-width: 1px;">
                                                <div class="ui-fchain-item-load"><span data-bind="text: Math.ceil(100*parseFloat(producedAmount()))/100"></span><span> t/min</span></div>
                                            </div>



                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div data-bind="foreach: $data.consumers">

                            <div class="ui-fchain-item" data-bind="visible: !$root.settings.hideNewWorldConstructionMaterial.checked() || $data.region.guid === 5000000, css: $root.settings.missingBuildingsHighlight.checked() && buildings() > existingBuildings() ? 'danger' : ''">
                                <div class="ui-fchain-item-name" data-bind="text: $data.getRegionExtendedName(), visible: !$root.settings.hideNames.checked()"></div>
                                <div class="ui-fchain-item-icon"><img src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>


                                <!-- buildings input  -->
                                <div class="ui-fchain-item-count">
                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                        <div class="input-group mb-3 spinner">
                                            <input class="form-control" type="text" value="0" step="1" data-bind="value: existingBuildings" />
                                            <div class="input-group-append">
                                                <div class="input-group-btn-vertical">
                                                    <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings()) + 1)"><i class="fa fa-caret-up"></i></button>
                                                    <button class="btn btn-default" type="button" data-bind="click: () => existingBuildings(parseInt(existingBuildings()) - 1), enable: existingBuildings() > 0"><i class="fa fa-caret-down"></i></button>
                                                </div>
                                                <span class="input-group-text">x</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <!-- required buildings display -->
                                <div class="ui-fchain-item-count" data-bind="if: buildings() > existingBuildings()">
                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildingsDescription.name}">
                                        <span data-bind="text: $root.texts.requiredNumberOfBuildings.name"></span>
                                        <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? Math.ceil(100*parseFloat(buildings()))/100 : Math.ceil(buildings())"></span>
                                        <span>x</span>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-secondary" data-bind="click: () => incrementBuildings(), enable: buildings() > 0" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                            <button type="button" class="btn btn-secondary" data-bind="click: () => decrementBuildings(), enable: buildings() > 1.00001" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                        </div>
                                    </div>
                                </div>

                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                    <div class="ui-fchain-item-load"><span data-bind="text: Math.ceil(100*parseFloat(amount()))/100"></span><span> t/min</span></div>

                                </div>
                            </div>



                        </div>
                    </div>
                    <div class="clear"></div>
                </fieldset>
            </div>
            <!-- /required factories by category -->
            <!-- #good-consumption-upgrade-dialog -->
            <div id="good-consumption-upgrade-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" data-bind="with: $root.selectedGoodConsumptionUpgradeList()">
                        <div class="modal-header">
                            <h4 data-bind="text: $root.texts.needConsumption.name">Need Consumption</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                        </div>
                        <div class="modal-body">
                            <h6 data-bind="text: $root.texts.newspaper.name">Newspaper</h6>
                            <form>
                                <div class="form mb-3" data-bind="foreach: $root.newspaperConsumption.allEffects">
                                    <span class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                        <label class="custom-control-label" data-bind="text: $data.name() + ' ' + formatPercentage($data.amount), attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                    </span>
                                </div>

                                <div class="form-inline">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" data-bind="text: $root.texts.newspaperEffectiveness.name">Newspaper Effectiveness</span>
                                        </div>

                                        <select class="custom-select" data-bind="value: $root.newspaperConsumption.selectedBuff, options: $root.newspaperConsumption.selectableBuffs, optionsText: p => formatPercentage(p)"></select>
                                    </div>

                                    <div class="custom-control">
                                        <span data-bind="text: $root.texts.reducedNeeds.name">Reduced Needs</span>
                                        <span>: </span>
                                        <span data-bind="text: formatPercentage($root.newspaperConsumption.amount())"></span>
                                    </div>
                                </div>
                            </form>
                            <table class="table table-striped">
                                <tbody data-bind="foreach: $data.upgrades">
                                    <tr>
                                        <td>

                                            <span class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.upgrade.checked, attr: { id: $data.upgrade.guid + '-checked' }">
                                                <label class="custom-control-label" data-bind="attr: { for: $data.upgrade.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                            </span>
                                        </td>
                                        <td><img src="" width="25" height="25" data-bind="attr: { src: $data.upgrade.icon ? $data.upgrade.icon : null}"></td> <!-- upgrade icon -->
                                        <td data-bind="text: $data.upgrade.name"></td> <!-- upgrade name -->
                                        <td><span data-bind="text: formatPercentage($data.amount)"></span></td>

                                    </tr>
                                </tbody>
                            </table>

                        </div>
                        <div class="modal-footer">
                            <span data-bind="text: $root.texts.total.name">Total</span>
                            <span>: </span>
                            <span data-bind="text: formatPercentage($data.amount())"></span>
                            <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="click: () => $data.apply()">
                                <span class="fa fa-sign-in"> </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- #/good-consumption-upgrade-dialog -->
            <!-- production chains by population level -->
            <div data-bind="foreach: { data: $data.populationLevels, as: 'populationLevel'}">
                <fieldset class="ui-fieldset" id="consumption-view" data-bind="visible: amount() || existingBuildings()">
                    <legend class="collapser" data-toggle="collapse" data-bind="attr: {'data-target' : '#consumption-' +  guid}">
                        <span class="fa fa-chevron-right"></span>
                        <span class="fa fa-chevron-down"></span>
                        <span data-bind="text:name"></span>
                    </legend>
                    <div class="collapse show" data-bind="foreach: needs, attr:{id: 'consumption-' +  guid}">
                        <div class="ui-fchain" data-bind="visible: optionalAmount(), css:{inactive: banned}">
                            <div class="d-flex flex-wrap align-content-start" data-bind="foreach: allDemands">
                                <div class="ui-fchain-spacer" data-bind="visible: !($data instanceof Need) && amount()">
                                    ←
                                </div>
                                <div class="ui-fchain-item" data-bind="visible: ($data instanceof Need) || amount()">
                                    <div data-bind="if: ($data instanceof Need)" class="ui-fchain-item-tr-checkbox">
                                        <div>
                                            <span class="custom-control custom-checkbox">
                                                <input class="custom-control-input" data-bind="checked: $data.checked, attr: { id: populationLevel.guid + '-' + $data.product.guid + '-checked' }" type="checkbox">
                                                <label class="custom-control-label" src-only="" data-bind="attr: { for: populationLevel.guid + '-' + $data.product.guid + '-checked' }">&#8203;</label>
                                            </span>
                                    </div>
                                    </div>

                                    <div class="ui-fchain-item-name" data-bind="text: product.name, visible: !$root.settings.hideNames.checked()"></div>
                                    <div class="ui-fchain-item-icon">
                                        <img src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name }">
                                    </div>

                                    <div data-bind="if: $root.settings.consumptionModifier.checked() && ($data instanceof Need)">
                                        <div class="card bg-light mb-2 mt-2">
                                            <div style="display: flex; justify-content: space-between; vertical-align: bottom;">
                                                <div>
                                                    <img class="icon-dark" src="icon_marketplace_2d_dark.png" width="25" height="25" />
                                                    <img class="icon-light" src="icon_marketplace_2d_light.png" width="25" height="25" />
                                                </div>
                                                <div>
                                            <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedGoodConsumptionUpgradeList($data.goodConsumptionUpgradeList)}" data-toggle="modal" data-target="#good-consumption-upgrade-dialog">
                                                <span class="fa fa-sliders"></span>
                                            </button>

                                        </div>
                                    </div>
                                            <div class="input-group spinner" href="#" data-toggle="tooltip" data-bind="if: $data instanceof Need, attr: {'title' : $root.texts.consumptionModifier.name}, visible: $root.settings.consumptionModifier.checked()" title="Verändere die prozentuale Verbrauchsmenge für diese Ware und Bevölkerungsstufe" style="">
                                                <input class="form-control" type="text" value="100" min="1" data-bind="value: percentBoost">
                                        <div class="input-group-append">
                                            <div class="input-group-btn-vertical">
                                                <button class="btn btn-default" type="button" data-bind="click: incrementPercentBoost"><i class="fa fa-caret-up"></i></button>
                                                <button class="btn btn-default" type="button" data-bind="click: decrementPercentBoost, enable: parseInt(percentBoost()) > 1"><i class="fa fa-caret-down"></i></button>
                                            </div>
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                        </div>
                                    </div>

                                    <div style="margin: auto">
                                        <div data-bind="if: $root.settings.consumptionModifier.checked() && !($data instanceof Need)">
                                            <div style="height: calc(2.25rem + 2px);"></div>
                                        </div>
                                    <div class="ui-fchain-item-count">
                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                            <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? Math.ceil(100*parseFloat(buildings()))/100 : Math.ceil(buildings())"></span>
                                            <span>x</span>
                                        </span>
                                    </div>
                                    <div class="ui-fchain-item-load">
                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                            <span data-bind="text: Math.ceil(100*parseFloat(amount()))/100"></span><span> t/min</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </fieldset>
            </div>
            <!-- /production chains by population level -->
            <!-- production chains for building materials -->
            <fieldset class="ui-fieldset" id="construction-material-view">
                <legend class="collapser" data-toggle="collapse" data-target="#building-materials-chains">
                    <span class="fa fa-chevron-right"></span>
                    <span class="fa fa-chevron-down"></span>
                    <span data-bind="text: $root.island().categories[1].name"></span>
                </legend>
                <div class="collapse show" data-bind="foreach: $data.buildingMaterialsNeeds" id="building-materials-chains">
                    <div class="ui-fchain" data-bind="visible: amount">
                        <div data-bind="foreach: $data.allDemands">
                            <div class="ui-fchain-spacer" data-bind="visible: !($data instanceof Need) && amount">
                                ←
                            </div>
                            <div class="ui-fchain-item" data-bind="visible: amount">
                                <div class="ui-fchain-item-name" data-bind="text: product.name, visible: !$root.settings.hideNames.checked()"></div>
                                <div class="ui-fchain-item-icon"><img src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name }"></div>
                                <div class="ui-fchain-item-count">
                                    <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                        <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? Math.ceil(100*parseFloat(buildings()))/100 : Math.ceil(buildings())"></span>
                                        <span>x</span>
                                    </span>
                                </div>
                                <div class="ui-fchain-item-load">
                                    <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                        <span data-bind="text: Math.ceil(100*parseFloat(amount()))/100"></span><span> t/min</span>
                                    </span>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
            </fieldset>
            <!-- /production chains for building materials -->
        </div>
    </div>
</body>
</html>
